<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile Save Editor</title>
</head>
<body>
  <h1>Profile Save Editor</h1>

  <textarea id="output" rows="20" cols="80" readonly></textarea><br><br>

  <button onclick="decryptProfile()">Decrypt Profile.save</button><br><br>

  <textarea id="editInput" rows="10" cols="80" placeholder="Edit your profile JSON here"></textarea><br><br>

  <button onclick="encryptAndSave()">Encrypt and Save</button>

  <script>
    // Paste your decryption logic here
    const fs = require('fs');
    const crypto = require('crypto');
    const zlib = require('zlib');

    const DUMMY_HEADER_LENGTH = 44;
    const PASSWORD_INDEX_LENGTH = 8;
    const SALT_LENGTH = 24;
    const KEY_LENGTH = 16;
    const IV_LENGTH = 16;
    const DERIVE_ITERATIONS = 10;
    const PASSWORD = '21';
    const algorithm = 'aes-128-cbc';

    async function decrypt() {
      const bytes = fs.readFileSync('./Profile.save');
      let salt = bytes.slice(DUMMY_HEADER_LENGTH + PASSWORD_INDEX_LENGTH, DUMMY_HEADER_LENGTH + PASSWORD_INDEX_LENGTH + SALT_LENGTH);
      let encryptedBytes = bytes.slice(DUMMY_HEADER_LENGTH + PASSWORD_INDEX_LENGTH + SALT_LENGTH, bytes.length);
      let derivedBytes = crypto.pbkdf2Sync(PASSWORD, salt, DERIVE_ITERATIONS, KEY_LENGTH + IV_LENGTH, 'sha1');

      let iv = derivedBytes.slice(0, 16);
      let key = derivedBytes.slice(16, 32);

      let decipher = crypto.createDecipheriv(algorithm, key, iv);
      let decrypted = await decipher.update(encryptedBytes);
      let final = decipher.final();
      let decryptedBytes = Buffer.concat([decrypted, final]);

      let json = zlib.inflateSync(decryptedBytes);
      return JSON.parse(json.toString().trim());
    }

    async function decryptProfile() {
      try {
        let profile = await decrypt();
        document.getElementById('output').value = JSON.stringify(profile, null, 2);
        document.getElementById('editInput').value = JSON.stringify(profile, null, 2);
      } catch (err) {
        console.error('Error decrypting:', err);
      }
    }

    async function encryptAndSave() {
      let editedProfileJson = document.getElementById('editInput').value;
      try {
        let editedProfile = JSON.parse(editedProfileJson);
        let jsonBuffer = Buffer.from(JSON.stringify(editedProfile));
        let compressedJson = zlib.deflateSync(jsonBuffer);

        let salt = crypto.randomBytes(SALT_LENGTH);
        let derivedBytes = crypto.pbkdf2Sync(PASSWORD, salt, DERIVE_ITERATIONS, KEY_LENGTH + IV_LENGTH, 'sha1');

        let iv = derivedBytes.slice(0, 16);
        let key = derivedBytes.slice(16, 32);

        let cipher = crypto.createCipheriv(algorithm, key, iv);
        let encrypted = Buffer.concat([cipher.update(compressedJson), cipher.final()]);

        // Prepare the final encrypted file content
        let header = Buffer.alloc(DUMMY_HEADER_LENGTH + PASSWORD_INDEX_LENGTH);
        let encryptedFile = Buffer.concat([header, salt, encrypted]);

        // Save to Profile.save (replace existing content)
        fs.writeFileSync('./Profile.save', encryptedFile);

        console.log('Profile encrypted and saved successfully.');
      } catch (err) {
        console.error('Error encrypting and saving:', err);
      }
    }
  </script>
</body>
</html>
